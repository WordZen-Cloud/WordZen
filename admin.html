<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordZen | Master Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background: #050505; color: #fff; margin: 0; padding: 15px; }
        .container { max-width: 700px; margin: 0 auto; }
        h1 { color: #39FF14; text-align: center; font-size: 1.4rem; margin-bottom: 20px; }
        
        .card { background: #111; padding: 15px; border-radius: 12px; border: 1px solid #222; margin-bottom: 15px; }
        .card-title { font-size: 0.8rem; color: #39FF14; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }
        
        input, textarea, select { width: 100%; background: #1a1a1a; border: 1px solid #333; border-radius: 6px; padding: 10px; color: #fff; margin-bottom: 8px; font-family: inherit; font-size: 0.9rem; }
        button { width: 100%; background: #39FF14; color: #000; border: none; padding: 10px; border-radius: 6px; font-weight: 800; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.97); }
        .btn-red { background: #ff4b2b; color: #fff; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .stat-box { background: #111; padding: 12px; border-radius: 10px; text-align: center; border: 1px solid #222; }
        .stat-val { font-size: 1.1rem; color: #39FF14; display: block; }
        .stat-lbl { font-size: 0.6rem; color: #888; }
        
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; margin-bottom: 10px; }
        .online { background: #39FF14; color: #000; }
        .maintenance { background: #ff4b2b; color: #fff; }
    </style>
</head>
<body>

<div class="container">
    <h1>WORDZEN MASTER PANEL</h1>

    <div id="maintenance-status" class="status-badge online">SÄ°STEM Ã‡EVRÄ°MÄ°Ã‡Ä°</div>

    <div class="grid-2" style="margin-bottom: 15px;">
        <div class="stat-box"><span id="total-users" class="stat-val">0</span><span class="stat-lbl">OYUNCU</span></div>
        <div class="stat-box"><span id="total-levels" class="stat-val">0</span><span class="stat-lbl">KELÄ°ME</span></div>
    </div>

    <div class="card">
        <div class="card-title">Sistem & Duyuru</div>
        <button id="maint-btn" class="btn-red" onclick="toggleMaintenance()" style="margin-bottom:10px;">BAKIM MODUNU AÃ‡</button>
        <input type="text" id="announcement-text" placeholder="Duyuru mesajÄ± yaz...">
        <button onclick="updateAnnouncement()" style="background:#fff">DUYURUYU YAYINLA</button>
    </div>

    <div class="card">
        <div class="card-title">Oyuncu DÃ¼zenle</div>
        <input type="text" id="target-user-id" placeholder="Oyuncu ID (Ã–rn: UZ_123456)">
        <div class="grid-2">
            <input type="number" id="mod-coin" placeholder="Jeton (+/-)">
            <input type="number" id="mod-level" placeholder="Seviye (+/-)">
        </div>
        <button onclick="managePlayer()">BÄ°LGÄ°LERÄ° GÃœNCELLE</button>
    </div>

    <div class="card">
        <div class="card-title">Yeni Kelime Ekle</div>
        <input type="text" id="word-input" placeholder="Kelime (Ã–rn: TÃœRKÄ°YE)">
        <textarea id="clue-input" placeholder="AnlamÄ±/Ä°pucu..." rows="2"></textarea>
        <button onclick="addLevel()">KELÄ°MEYÄ° SÄ°STEME EKLE</button>
    </div>

    <div class="card">
        <div class="card-title">Ayarlar & GÃ¶rsellik</div>
        <div class="grid-2">
            <div><label class="stat-lbl">Ä°PUCU ðŸª™</label><input type="number" id="hint-price"></div>
            <div><label class="stat-lbl">ATLA ðŸª™</label><input type="number" id="skip-price"></div>
        </div>
        <div>
            <label class="stat-lbl">ARKA PLAN DEÄžÄ°ÅžÄ°M SIKLIÄžI (KaÃ§ bÃ¶lÃ¼mde bir?)</label>
            <input type="number" id="bg-freq" placeholder="Ã–rn: 5">
        </div>
        <button onclick="updateConfig()" style="background:#fff">TÃœM AYARLARI KAYDET</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getDatabase, ref, set, push, get, update, onValue } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCFgWqiyOv1UWfehf8zUtu4XqsXTrRdcZc",
        authDomain: "wordzen-2e052.firebaseapp.com",
        databaseURL: "https://wordzen-2e052-default-rtdb.firebaseio.com",
        projectId: "wordzen-2e052",
        storageBucket: "wordzen-2e052.firebasestorage.app",
        messagingSenderId: "309225718128",
        appId: "1:309225718128:web:8a38717b4b6fc8f3a18fb5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // CANLI VERÄ° TAKÄ°BÄ°
    onValue(ref(db, 'users'), s => document.getElementById('total-users').innerText = s.exists() ? Object.keys(s.val()).length : 0);
    onValue(ref(db, 'levels'), s => document.getElementById('total-levels').innerText = s.exists() ? Object.keys(s.val()).length : 0);
    
    // BAKIM DURUMU TAKÄ°BÄ°
    onValue(ref(db, 'admin/config'), s => {
        if(s.exists()){
            const data = s.val();
            const isMaint = data.maintenance_mode;
            const badge = document.getElementById('maintenance-status');
            const btn = document.getElementById('maint-btn');
            
            badge.innerText = isMaint ? "BAKIM MODU AKTÄ°F" : "SÄ°STEM Ã‡EVRÄ°MÄ°Ã‡Ä°";
            badge.className = isMaint ? "status-badge maintenance" : "status-badge online";
            btn.innerText = isMaint ? "BAKIM MODUNU KAPAT" : "BAKIM MODUNU AÃ‡";
            btn.setAttribute('data-state', isMaint);

            document.getElementById('hint-price').value = data.hint_price || 10;
            document.getElementById('skip-price').value = data.skip_price || 50;
            document.getElementById('bg-freq').value = data.bg_frequency || 10;
            document.getElementById('announcement-text').value = data.announcement || "";
        }
    });

    // BAKIM MODU AÃ‡/KAPAT
    window.toggleMaintenance = async () => {
        const btn = document.getElementById('maint-btn');
        const currentState = btn.getAttribute('data-state') === 'true';
        await update(ref(db, 'admin/config'), { maintenance_mode: !currentState });
        alert("BakÄ±m modu durumu deÄŸiÅŸtirildi!");
    };

    // DUYURU GÃœNCELLE
    window.updateAnnouncement = async () => {
        const txt = document.getElementById('announcement-text').value;
        await update(ref(db, 'admin/config'), { announcement: txt });
        alert("Duyuru yayÄ±nlandÄ±!");
    };

    // OYUNCU YÃ–NETÄ°MÄ°
    window.managePlayer = async () => {
        const uid = document.getElementById('target-user-id').value.trim();
        const coinMod = parseInt(document.getElementById('mod-coin').value) || 0;
        const levelMod = parseInt(document.getElementById('mod-level').value) || 0;

        if(!uid) return alert("Oyuncu ID gir!");

        const userRef = ref(db, 'users/' + uid);
        const snap = await get(userRef);
        
        if(snap.exists()){
            const newData = {
                coins: (snap.val().coins || 0) + coinMod,
                level: (snap.val().level || 0) + levelMod
            };
            await update(userRef, newData);
            alert("Oyuncu gÃ¼ncellendi!");
        } else { alert("Oyuncu bulunamadÄ±!"); }
    };

    // KELÄ°ME EKLE
    window.addLevel = async () => {
        const a = document.getElementById('word-input').value.trim().toUpperCase();
        const m = document.getElementById('clue-input').value.trim();
        if(a && m) {
            await set(push(ref(db, 'levels')), { a, m });
            document.getElementById('word-input').value = "";
            document.getElementById('clue-input').value = "";
            alert("Kelime eklendi!");
        }
    };

    // AYARLARI GÃœNCELLE
    window.updateConfig = async () => {
        await update(ref(db, 'admin/config'), {
            hint_price: parseInt(document.getElementById('hint-price').value),
            skip_price: parseInt(document.getElementById('skip-price').value),
            bg_frequency: parseInt(document.getElementById('bg-freq').value)
        });
        alert("Ayarlar kaydedildi!");
    };
</script>
</body>
</html>